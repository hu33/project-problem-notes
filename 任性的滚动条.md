## 任性的滚动条



最近在开发自定义表情收藏需求时，不小心踩进了滚动条的一个坑，虽然知道滚动条有坑，但它也是太任性了点吧。

### 问题描述

正式开发前，设计师上传了最终版设计稿，要求一屏显示4*6个：

![](http://ow7p6xhhi.bkt.clouddn.com/%E9%9D%A2%E6%9D%BF%E8%AE%BE%E8%AE%A1%E7%A8%BF.png)

嗯，这个设计稿没毛病，于是就开发，直接按照设计稿将面板的padding设为12px，无滚动条和有滚动条时分别是这样的：

![无滚动条](http://ow7p6xhhi.bkt.clouddn.com/%E6%97%A0%E6%BB%9A%E5%8A%A8%E6%9D%A1.png)

![正常滚动条](http://ow7p6xhhi.bkt.clouddn.com/%E6%AD%A3%E5%B8%B8%E6%BB%9A%E5%8A%A8%E6%9D%A1.png)

嗯，完美~~然后提测，坐等上线。

但是，第二天QA就给报了个bug，说我咋不按设计稿进行开发。Excuse me？？然后我一看QA的截图，是这样子的：

![滚动条bug](http://ow7p6xhhi.bkt.clouddn.com/%E6%BB%9A%E5%8A%A8%E6%9D%A1bug.png)

这个滚动条怎么跟我的滚动条不一样呢：长的不一样，QA这个滚动条的宽度明显比我的滚动条要宽嘛。找了一下原因，发现是QA设置了滚动条的显示状态为始终显示（在系统的通用设置中）：

![滚动条设置](http://ow7p6xhhi.bkt.clouddn.com/%E6%BB%9A%E5%8A%A8%E6%9D%A1%E8%AE%BE%E7%BD%AE.png)

我们一般Mac系统默认的滚动条显示状态为第一个或第二个，跟始终显示效果上有什么差别呢？（这里只谈论Mac上的）

- 非始终显示时，滚动条的样式是没有滚动槽的，始终显示时，滚动条样式中带滚动槽

- 非始终显示时，div的滚动条是不占位的，相当于是浮在div上的；而始终显示时，div的滚动条会额外占据15px的宽度。可以看一下始终显示和非始终显示时表情列表(设了overflow-y为auto的div)的盒模型：

  ![417的盒模型](http://ow7p6xhhi.bkt.clouddn.com/417%E7%9A%84%E7%9B%92%E6%A8%A1%E5%9E%8B.png)

  ![432的盒模型](http://ow7p6xhhi.bkt.clouddn.com/432%E7%9A%84%E7%9B%92%E6%A8%A1%E5%9E%8B.png)

  可以看到，滚动条始终显示时width是417px，非始终显示时width是432px，说明始终显示的滚动条占了15px的位置，导致width变小了（因为该div的width设为auto的）。

- 非始终显示的滚动条只有在滚动的时候出现，其余时间滚动条是隐藏的，而始终显示的滚动条就是一直出现的（当然是有滚动条的地方）。

所以呢，出于上述第二个差别，导致QA那边表情面板的展示就不对了，我在runjs上简单还原了一下现场，可以通过设置通用中滚动条的显示方式来看一下差别和问题：[scrollbar-origin](http://runjs.cn/code/e8cysoa4)。

#### 方案一：

一开始用了个很蠢的方式，我将每个表情的大小都缩小了2px，这样就空出12px，然后将面板宽度扩大3px，当当~15px的空余空间不就出来啦~宽阔的滚动条就能和我的表情列表和平共处啦，所以结果是酱紫的：

![方案一1](http://ow7p6xhhi.bkt.clouddn.com/%E6%96%B9%E6%A1%88%E4%B8%801.jpg)

但是问题来了，我要是在右边空出了15px，滚动条自动隐藏时，右边就会显得格外的空旷，很明显两边不一样间隔不一样了，如下图：

![方案一2](http://ow7p6xhhi.bkt.clouddn.com/%E6%96%B9%E6%A1%88%E4%B8%802.jpg)

而且还会有第二个问题：UI在设计的时候，已经严格计算好三种类型表情的大小和排列方式，但是我在这里改了下自定义表情的大小，又改了面板的宽度，导致其余两个表情列表显示也有问题了，最大的问题就在于右边边距明显宽了很多，用户UI体验不好。所以方案一pass！

请自行切换滚动条显示状态[体会一下](http://runjs.cn/code/aoh521bn)~

#### 方案二：

为了解决方案一中右边间距很宽的问题，方案二稍微优化了下：始终显示的滚动条不是会占据smiley-list的15px，导致smiley-list宽度减少15px而把第6个表情挤下去吗？那咱可以把滚动条移出来，放到父元素smiley-panel中进行滚动，然后强制设置smiley-list的宽度为固定值，这样不管滚动条显示还是不显示，宽的还是窄的，都跟smiley-list无关，smiley-list中的图片就不会因为宽度缩小而被挤下去了。

具体的效果请戳[这里](http://runjs.cn/code/d9fiqpyt)。

好的，方案一的两个问题解决啦~比起方案一，优势如下：

1. 方案二完全按照UI稿进行开发的，另外两个表情面板的设计也不受影响
2. 滚动条不显示时，两边的边距一样宽
3. 滚动条始终显示时，每排最后一个表情也不会被挤下去

巴特！你以为滚动条会这么轻易放过你吗？有没有发现，设置滚动条为始终显示时，也就是滚动条宽度为15px的时候，最右边那列表情都没有空间啦，看起来好挤啊。

![方案二1](http://ow7p6xhhi.bkt.clouddn.com/%E6%96%B9%E6%A1%88%E4%BA%8C1.png)

这时候，UI又来找了，说酱紫不好，最边上那个表情都顶到滚动条里面去了，安全距离都没有了，看着很不爽的。这就有点尴尬了，方案一和方案二，要么滚动条不显示时右边间距宽了，要不滚动条始终显示时右边没间距了，那有没有一种方法，可以同时解决这两个问题。于是，我们去了解了下别人的解决方案。

### 已有方案

偷偷去看了下钉钉和微信中表情面板的滚动条方案，发现钉钉自定义了滚动条样式，微信使用了jquery-scroll插件。GitHub上还有比较多的自定义滚动条插件和组件。

#### 自定义滚动条样式

钉钉是用方案二的方式解决了方案一的问题，然后将滚动条的样式自定义了一下，这样不管用户将滚动条显示状态设置为什么，滚动条的样式都是自定义的样式。这样也解决了方案二的问题：由于滚动条过宽导致最右侧的表情视觉边距大大缩小。

但是自定义滚动条样式又引出了另一个问题：一旦自定义了滚动条的样式，那么滚动条会始终显示。意思是，不管系统设置滚动条显示状态为什么，那些自定义了样式的滚动条都会始终显示，不会自动隐藏了。

#### jquery-scroll插件

jQuery中有几个滚动条的插件，其中jQuery-scroll应用地比较多，其样式和类型也很多，用户可以自定义多种类型的滚动条。具体示例请[戳这儿](https://gromo.github.io/jquery.scrollbar/demo/basic.html)~

#### perfect-scrollbar插件

这是个自定义滚动条插件，源码和具体使用[戳这儿](https://github.com/utatti/perfect-scrollbar)~

#### react-scrollbar组件

这个一看就知道是个react组件了，源码和具体使用[戳这儿](https://github.com/BosNaufal/react-scrollbar)~

###目前方案

考虑到开发成本，我们最终采取了自定义滚动条样式的方案。由于滚动条自定义样式后会始终显示，不会自动隐藏，因此只设置了表情面板中滚动条的样式，其余地方滚动条不受影响。

[效果demo](http://runjs.cn/code/srcmu8oo)



TODO

1. 四种已有解决方案的使用方式都试一遍，并将demo代码总结贴上来。